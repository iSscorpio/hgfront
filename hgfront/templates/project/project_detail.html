{% extends "project/project_list.html" %}
{% load core_templatetags %}

{% block title %}{{block.super}} Project details for {{project.name_long}} ({{project.name_short}}){% endblock %}

{% block content_title %}{{project.name_long}}{% endblock %}
{% block breadcrumbs %}{{block.super}}<li class="project">&raquo; <a href="{{project.get_absolute_url}}">{{project.name_long}}</a></li>{% endblock %}

{% block main_content %}

	<ul id="project-details-tabs" class="flora">
		<li><a href="#project-details"><span>Project Details</span></a></li>
		<li><a href="#project-repositories"><span>Project Repositories</span></a></li>
		<li><a href="#project-issues"><span>Project Issues</span></a></li>
		<li><a href="#project-members"><span>Project Members</span></a></li>
	</ul>

	<div id="project-details">
		<h3>Project Details</h3>
	    <dl id="project-details">
    	    <dt>Project Name</dt>
	        <dd>{{project.name_long}}</dd>
	        <dt>Project Owner</dt>
	        <dd><a href="{{project.user_owner.get_absolute_url}}">{{project.user_owner}}</a></dd>
	        <dt>Project Description</dt>
	        <dd>{{project.description_long}}</dd>
	    </dl>	
	</div>
	
	<div id="project-repositories">
		{% with project.repo_set.select_related as repos %}
        	{% if repos %}
				<h2>Repositories {{project.name_long}}</h2>
				<ul>
					{% for repo in repos %}
				 		{% if repo.repo_created %}
							<li>
								<a href="{{repo.get_absolute_url}}" class="link-show-repo">{{repo.name_long}}</a>
								<div>
									<dl>
										<dt>Last Changeset ID</dt>
										<dd>
									 		{% ifequal repo.get_changeset_number -1 %}
	                                    		No Changesets (please add and commit files).
    	                           			{% else %}
	                                  				{{repo.get_changeset_number}} - {{repo.get_changeset}}
	    	                           		{% endifequal %}
										</dd>
								</div>
							</li>
						{% endif %}
	            	{% endfor %}
				</ul>
        	{% endif %}
    	{% endwith %}
	</div>
	
	<div id="project-issues">
		{% if permissions.view_issues %}
        	{% if issues %}
            	<table>
                	<thead>
                    	<caption>Recent Issues for {{project.name_long}}</caption>
	                    <tr>
    	                    <th>Title</th>
	                        <th>Created by</th>
    	                </tr>
	                </thead>
    	            <tbody>
        	            {% for issue in issues %}
	                        <tr>
    	                        <td><a href="{{issue.get_absolute_url}}">{{issue.title}}</a></td>
	                            <td><a href="{{issue.user_posted.get_absolute_url}}">{{issue.user_posted.username}}</a></td>
	                        </tr>
	                    {% endfor %}
	                </tbody>
	            </table>
	            <a href="{% url issue-list project.name_short %}">view all issues for this project</a><br/>
    	        <a href="{% url issue-list project.name_short %}?completed=no">view live issues for this project</a><br/>
	            <a href="{% url issue-list project.name_short %}?completed=yes">view completed issues for this project</a>
	        {% else %}
    	        <h4>This project has no issues, yay!</h4>
	        {% endif %}
        {% else %}
            <h4>You can't view the issues, man!</h4>
        {% endif %}	
	</div>
    
	<div id="project-members">
	    {% with project.members as members %}
    	    <dl id="project-members">
        	    <dt>Project Members</dt>
            	{% for member in members %}
                	<dd><a href="{{member.get_absolute_url}}">{{member.username}}</a></dd>
	            {% endfor %}
    	    </dl>
	    {% endwith %}
    
	    {% if user_can_request_to_join %} 
	        <form method="post" action="{% url project-join-project slug=project.name_short %}">
	            If you want to join this project, click on this button!
	            <input type="submit" value="Join" />
	        </form>
    	{% endif %}
	</div>
    
	<div id="project-backups">
	    {% if backups %}
	        <table>
	            <thead>
	                <caption>Backups of {{project.name_long}}</caption>
	                <tr>
	                    <th>Creation Date</th>
	                    <th>Format</th>
	                </tr>
	            </thead>
	            <tbody>
	                {% for backup in backups %}
	                    <tr>
	                        <td>{{backup.created}}</td>
	                        <td>{{backup.format}}</td>
	                     </tr>
	                 {% endfor %}
	             </tbody>
	         </table>
	     {% endif %}
    </div>
{% endblock %}

{% block sidebar %}
	{% menubox project.name_long %}
        <ul>
            {% if permissions.add_repos %} 
                <li><a href="{% url repo-create project.name_short %}" class="link-create-repo">Create New Repo</a></li>
            {% endif %}
            {% if permissions.add_issues %} 
                <li><a href="{% url issue-create project.name_short %}" class="link-create-issue">Create New Issue</a></li>
            {% endif %}
            {% if permissions.add_repos %} 
                <li><a href="{% url create-backup project.name_short %}" class="link-create-backup">Backup Project</a></li>
            {% endif %}
        </ul>
    {% with project.aspiring_members as aspiring_members %}
        {% if permissions.add_members and aspiring_members %}
            <span class="group">Join requests</span>
            <p>These people want to join {{project.name_long}}!</p>
            <ul>
                {% for member in aspiring_members %}
                <li>
                    <a href="{{member.get_absolute_url}}">{{member.username}}</a>
                    <form method="post" action="{% url project-process-join-request slug=project.name_short %}" style="float:left">
                        <input type="hidden" name="username" value="{{member.username}}" />
                        <input type="hidden" name="action" value="accept" />
                        <input type="submit" value="approve" />
                    </form>
                    <form method="post" action="{% url project-process-join-request slug=project.name_short %}" style="float:left;">
                        <input type="hidden" name="username" value="{{member.username}}" />
                        <input type="hidden" name="action" value="deny" />
                        <input type="submit" value="deny" />
                    </form>
                    <div style="clear:both"></div>
                </li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
    {% with project.invited_members as invited_members %}
        {% if permissions.add_members and invited_members %}
            <span class="group">Invited users</span>
            <p>You have invited these guys to join {{project.name_long}}</p>
            <ul>
                {% for member in invited_members %}
                    <li><a href="{{member.get_absolute_url}}">{{member.username}}</a></li>
                {% endfor %}
            </ul>
        {% endif %}
		{% endwith %}
	{% endmenubox %}
{% endblock %}
